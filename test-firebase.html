<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Firebase Test - TGRA</title>
  <style>
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }
    
    body {
      font-family: -apple-system, sans-serif;
      background: #0a0a0f;
      color: white;
      padding: 20px;
      min-height: 100vh;
    }
    
    h1 {
      color: #00ff88;
      margin-bottom: 20px;
      font-size: 1.5rem;
    }
    
    .test-section {
      background: #1a1a2e;
      border-radius: 12px;
      padding: 15px;
      margin-bottom: 15px;
    }
    
    .test-section h3 {
      color: #58a6ff;
      margin-bottom: 10px;
      font-size: 1rem;
    }
    
    .status {
      padding: 8px 12px;
      border-radius: 8px;
      margin: 5px 0;
      font-size: 0.9rem;
      word-break: break-all;
    }
    
    .status.success {
      background: rgba(0, 255, 136, 0.2);
      border: 1px solid #00ff88;
      color: #00ff88;
    }
    
    .status.error {
      background: rgba(255, 107, 107, 0.2);
      border: 1px solid #ff6b6b;
      color: #ff6b6b;
    }
    
    .status.info {
      background: rgba(88, 166, 255, 0.2);
      border: 1px solid #58a6ff;
      color: #58a6ff;
    }
    
    .status.warning {
      background: rgba(255, 217, 61, 0.2);
      border: 1px solid #ffd93d;
      color: #ffd93d;
    }
    
    input {
      width: 100%;
      padding: 12px;
      margin: 8px 0;
      border: 1px solid #333;
      border-radius: 8px;
      background: #0d1117;
      color: white;
      font-size: 1rem;
    }
    
    button {
      width: 100%;
      padding: 15px;
      margin: 8px 0;
      border: none;
      border-radius: 8px;
      font-size: 1rem;
      font-weight: 600;
      cursor: pointer;
    }
    
    .btn-primary {
      background: #00ff88;
      color: #0a0a0f;
    }
    
    .btn-secondary {
      background: #333;
      color: white;
    }
    
    .btn-google {
      background: white;
      color: #333;
    }
    
    .btn-danger {
      background: #ff6b6b;
      color: white;
    }
    
    #logArea {
      background: #0d1117;
      border: 1px solid #333;
      border-radius: 8px;
      padding: 15px;
      max-height: 300px;
      overflow-y: auto;
      font-family: monospace;
      font-size: 0.85rem;
      line-height: 1.6;
    }
    
    .log-entry {
      padding: 5px 0;
      border-bottom: 1px solid #222;
    }
    
    .back-link {
      display: inline-block;
      color: #58a6ff;
      text-decoration: none;
      margin-bottom: 20px;
    }
  </style>
</head>
<body>

  <a href="index.html" class="back-link">‚Üê Back to Home</a>
  
  <h1>üî• Firebase Test Page</h1>
  
  <!-- Step 1: Check Firebase SDK -->
  <div class="test-section">
    <h3>Step 1: Firebase SDK</h3>
    <div id="sdkStatus"></div>
  </div>
  
  <!-- Step 2: Check Firebase Init -->
  <div class="test-section">
    <h3>Step 2: Firebase Initialization</h3>
    <div id="initStatus"></div>
  </div>
  
  <!-- Step 3: Check Services -->
  <div class="test-section">
    <h3>Step 3: Services</h3>
    <div id="servicesStatus"></div>
  </div>
  
  <!-- Step 4: Current User -->
  <div class="test-section">
    <h3>Step 4: Current User</h3>
    <div id="userStatus"></div>
  </div>
  
  <!-- Step 5: Test Signup -->
  <div class="test-section">
    <h3>Step 5: Test Signup</h3>
    <input type="text" id="testUsername" placeholder="Username (min 3 chars)">
    <input type="email" id="testEmail" placeholder="Email">
    <input type="password" id="testPassword" placeholder="Password (min 6 chars)">
    <button class="btn-primary" onclick="testSignup()">Test Signup</button>
    <div id="signupStatus"></div>
  </div>
  
  <!-- Step 6: Test Login -->
  <div class="test-section">
    <h3>Step 6: Test Login</h3>
    <input type="email" id="loginEmail" placeholder="Email">
    <input type="password" id="loginPassword" placeholder="Password">
    <button class="btn-secondary" onclick="testLogin()">Test Login</button>
    <div id="loginStatus"></div>
  </div>
  
  <!-- Step 7: Test Google -->
  <div class="test-section">
    <h3>Step 7: Test Google Sign In</h3>
    <button class="btn-google" onclick="testGoogle()">Test Google Sign In</button>
    <div id="googleStatus"></div>
  </div>
  
  <!-- Step 8: Logout -->
  <div class="test-section">
    <h3>Step 8: Logout</h3>
    <button class="btn-danger" onclick="testLogout()">Test Logout</button>
    <div id="logoutStatus"></div>
  </div>
  
  <!-- All Logs -->
  <div class="test-section">
    <h3>üìã All Logs</h3>
    <button class="btn-secondary" onclick="document.getElementById('logArea').innerHTML=''">Clear Logs</button>
    <div id="logArea"></div>
  </div>

  <!-- Firebase SDK -->
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>

  <script>
    // ===================================================
    // LOGGING FUNCTION
    // ===================================================
    
    function log(message, type = 'info') {
      const logArea = document.getElementById('logArea');
      const time = new Date().toLocaleTimeString();
      const colors = {
        info: '#58a6ff',
        success: '#00ff88',
        error: '#ff6b6b',
        warning: '#ffd93d'
      };
      
      const entry = document.createElement('div');
      entry.className = 'log-entry';
      entry.innerHTML = `<span style="color: #888;">[${time}]</span> <span style="color: ${colors[type]}">${message}</span>`;
      logArea.appendChild(entry);
      logArea.scrollTop = logArea.scrollHeight;
    }
    
    function showStatus(elementId, message, type) {
      const el = document.getElementById(elementId);
      el.innerHTML = `<div class="status ${type}">${message}</div>`;
    }
    
    function addStatus(elementId, message, type) {
      const el = document.getElementById(elementId);
      el.innerHTML += `<div class="status ${type}">${message}</div>`;
    }

    // ===================================================
    // STEP 1: CHECK SDK
    // ===================================================
    
    log('Starting Firebase tests...', 'info');
    
    if (typeof firebase !== 'undefined') {
      showStatus('sdkStatus', '‚úÖ Firebase SDK loaded successfully!', 'success');
      log('‚úÖ Firebase SDK loaded', 'success');
    } else {
      showStatus('sdkStatus', '‚ùå Firebase SDK NOT loaded! Check your internet connection.', 'error');
      log('‚ùå Firebase SDK failed to load', 'error');
    }

    // ===================================================
    // STEP 2: INITIALIZE FIREBASE
    // ===================================================
    
    const firebaseConfig = {
      apiKey: "AIzaSyAvFxqMFGUfFpD72rkGVUCIO4saUrW7a9E",
      authDomain: "tgra-backend.firebaseapp.com",
      projectId: "tgra-backend",
      storageBucket: "tgra-backend.firebasestorage.app",
      messagingSenderId: "685326018298",
      appId: "1:685326018298:web:f8e97ff8e68da625fb8b43",
      measurementId: "G-BLLZTVYHSL"
    };
    
    let auth, db;
    
    try {
      if (typeof firebase !== 'undefined') {
        firebase.initializeApp(firebaseConfig);
        showStatus('initStatus', '‚úÖ Firebase initialized successfully!', 'success');
        log('‚úÖ Firebase initialized', 'success');
        
        auth = firebase.auth();
        db = firebase.firestore();
      }
    } catch (error) {
      showStatus('initStatus', '‚ùå Error: ' + error.message, 'error');
      log('‚ùå Init error: ' + error.message, 'error');
    }

    // ===================================================
    // STEP 3: CHECK SERVICES
    // ===================================================
    
    if (auth) {
      addStatus('servicesStatus', '‚úÖ Auth service ready', 'success');
      log('‚úÖ Auth service ready', 'success');
    } else {
      addStatus('servicesStatus', '‚ùå Auth service NOT available', 'error');
      log('‚ùå Auth service failed', 'error');
    }
    
    if (db) {
      addStatus('servicesStatus', '‚úÖ Firestore service ready', 'success');
      log('‚úÖ Firestore service ready', 'success');
    } else {
      addStatus('servicesStatus', '‚ùå Firestore service NOT available', 'error');
      log('‚ùå Firestore service failed', 'error');
    }

    // ===================================================
    // STEP 4: CHECK CURRENT USER
    // ===================================================
    
    if (auth) {
      auth.onAuthStateChanged((user) => {
        if (user) {
          showStatus('userStatus', '‚úÖ Logged in as: ' + user.email, 'success');
          log('‚úÖ Current user: ' + user.email, 'success');
        } else {
          showStatus('userStatus', 'üë§ Not logged in (this is normal)', 'info');
          log('üë§ No user logged in', 'info');
        }
      });
    }

    // ===================================================
    // STEP 5: TEST SIGNUP
    // ===================================================
    
    async function testSignup() {
      const username = document.getElementById('testUsername').value.trim();
      const email = document.getElementById('testEmail').value.trim();
      const password = document.getElementById('testPassword').value;
      
      log('üîÑ Starting signup test...', 'info');
      showStatus('signupStatus', 'üîÑ Testing signup...', 'info');
      
      // Validation
      if (!username || username.length < 3) {
        showStatus('signupStatus', '‚ùå Username must be at least 3 characters', 'error');
        log('‚ùå Validation failed: username too short', 'error');
        return;
      }
      
      if (!email) {
        showStatus('signupStatus', '‚ùå Email is required', 'error');
        log('‚ùå Validation failed: no email', 'error');
        return;
      }
      
      if (!password || password.length < 6) {
        showStatus('signupStatus', '‚ùå Password must be at least 6 characters', 'error');
        log('‚ùå Validation failed: password too short', 'error');
        return;
      }
      
      try {
        log('üîÑ Creating user account...', 'info');
        
        const userCredential = await auth.createUserWithEmailAndPassword(email, password);
        const user = userCredential.user;
        
        log('‚úÖ User created: ' + user.uid, 'success');
        
        // Update profile
        log('üîÑ Updating profile...', 'info');
        await user.updateProfile({
          displayName: username
        });
        log('‚úÖ Profile updated', 'success');
        
        // Create Firestore document
        log('üîÑ Creating Firestore document...', 'info');
        await db.collection('users').doc(user.uid).set({
          username: username,
          email: email,
          createdAt: firebase.firestore.FieldValue.serverTimestamp()
        });
        log('‚úÖ Firestore document created', 'success');
        
        showStatus('signupStatus', '‚úÖ SIGNUP SUCCESSFUL! User: ' + user.email, 'success');
        
      } catch (error) {
        log('‚ùå Signup error code: ' + error.code, 'error');
        log('‚ùå Signup error message: ' + error.message, 'error');
        showStatus('signupStatus', '‚ùå Error: ' + error.code + ' - ' + error.message, 'error');
      }
    }

    // ===================================================
    // STEP 6: TEST LOGIN
    // ===================================================
    
    async function testLogin() {
      const email = document.getElementById('loginEmail').value.trim();
      const password = document.getElementById('loginPassword').value;
      
      log('üîÑ Starting login test...', 'info');
      showStatus('loginStatus', 'üîÑ Testing login...', 'info');
      
      if (!email || !password) {
        showStatus('loginStatus', '‚ùå Email and password required', 'error');
        log('‚ùå Validation failed: missing email or password', 'error');
        return;
      }
      
      try {
        log('üîÑ Attempting login...', 'info');
        
        const userCredential = await auth.signInWithEmailAndPassword(email, password);
        
        log('‚úÖ Login successful: ' + userCredential.user.email, 'success');
        showStatus('loginStatus', '‚úÖ LOGIN SUCCESSFUL! User: ' + userCredential.user.email, 'success');
        
      } catch (error) {
        log('‚ùå Login error code: ' + error.code, 'error');
        log('‚ùå Login error message: ' + error.message, 'error');
        showStatus('loginStatus', '‚ùå Error: ' + error.code + ' - ' + error.message, 'error');
      }
    }

    // ===================================================
    // STEP 7: TEST GOOGLE
    // ===================================================
    
    async function testGoogle() {
      log('üîÑ Starting Google sign in test...', 'info');
      showStatus('googleStatus', 'üîÑ Opening Google popup...', 'info');
      
      try {
        const provider = new firebase.auth.GoogleAuthProvider();
        
        log('üîÑ Opening popup...', 'info');
        const result = await auth.signInWithPopup(provider);
        
        log('‚úÖ Google sign in successful: ' + result.user.email, 'success');
        showStatus('googleStatus', '‚úÖ GOOGLE SUCCESS! User: ' + result.user.email, 'success');
        
      } catch (error) {
        log('‚ùå Google error code: ' + error.code, 'error');
        log('‚ùå Google error message: ' + error.message, 'error');
        showStatus('googleStatus', '‚ùå Error: ' + error.code + ' - ' + error.message, 'error');
      }
    }

    // ===================================================
    // STEP 8: TEST LOGOUT
    // ===================================================
    
    async function testLogout() {
      log('üîÑ Starting logout test...', 'info');
      showStatus('logoutStatus', 'üîÑ Logging out...', 'info');
      
      try {
        await auth.signOut();
        log('‚úÖ Logout successful', 'success');
        showStatus('logoutStatus', '‚úÖ LOGOUT SUCCESSFUL!', 'success');
        
      } catch (error) {
        log('‚ùå Logout error: ' + error.message, 'error');
        showStatus('logoutStatus', '‚ùå Error: ' + error.message, 'error');
      }
    }
    
    log('üèÅ Test page ready!', 'success');
  </script>

</body>
  </html>
